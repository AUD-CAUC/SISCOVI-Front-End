<div class="container">
    <h2 class="center">Cadastar Ajuste</h2>
    <div class="row">
        <h4 class="center">Contrato</h4>
        <div class="row">
            <div class="col s8" id="selected-contrato-center">
                <select materialize="material_select" [materializeSelectOptions]="contratos"
                    (change)="enableField($event.target.value)" class="center center-align">
                    <option disabled>Selecione um Contrato</option>
                    <option *ngFor="let contrato of contratos" [value]="contrato.codigo">{{contrato.nomeDaEmpresa}} - Contrato Nº: {{contrato.numeroDoContrato}}
                    </option>
                </select>
            </div>
        </div>
    </div>
</div>
<div class="container">
    <div class="row" *ngIf="contrato">
        <form [formGroup]="myForm" materialize class="col s12">
            <h5 class="left-align">Informações Gerais</h5>
            <div class="row">
                <div class="input-field col s5">
                    <select materialize="material_select" [materializeSelectOptions]="tiposEventosContratuais" id="tipo_ajuste"
                            formControlName="tipoAjuste" required>
                        <option disabled>Selecione o tipo de Ajuste</option>
                        <option *ngFor="let tipoEvento of tiposEventosContratuais" [value]="tipoEvento.cod">{{tipoEvento.tipo}}
                        </option>
                    </select>
                    <label for="tipo_ajuste">Tipo de Ajuste<span class="mensagem-erro">*</span></label>
                </div>
                <div class="input-field col s5">
                    <select materialize="material_select" id="prorrogacao" formControlName="prorrogacao" required>
                        <option value="N" selected>Não</option>
                        <option value="S">Sim</option>
                    </select>
                    <label for="prorrogacao">Prorrogação<span class="mensagem-erro">*</span></label>
                </div>
                <div class="input-field col ">
                    <input class="validate" id="ativo" type="text" formControlName="ativo" [attr.disabled]="true">
                    <label for="ativo">Ativo</label>
                </div>
            </div>
            <div class="row">
                <div class="input-field col s4">
                    <select materialize="material_select" id="nome_gestor" [materializeSelectOptions]="usuarios"
                    formControlName="gestor">
                        <option disabled>Selecione o Nome do Gestor</option>
                        <option *ngFor="let usuario of usuarios" [value]="usuario.nome"
                        [selected]="usuario.nome == nomeGestorContrato ">{{usuario.nome}}
                        </option>
                    </select>
                    <label for="nome_gestor">Nome Do Gestor</label>
                </div>
                <div class="input-field col s4">
                    <select materialize="material_select" id="nome_substituto_1" [materializeSelectOptions]="usuarios"
                    formControlName="primeiroSubstituto">
                        <option disabled>Opcional</option>
                        <option *ngFor="let usuario of usuarios" [value]="usuario.nome"
                        [selected]="usuario.nome == primeiroSubstituto">{{usuario.nome}}
                        </option>
                    </select>
                    <label for="nome_substituto_1">Primeiro Substituto</label>
                </div>
                <div class="input-field col s4">
                    <select materialize="material_select" id="nome_substituto_2" class="validate"
                    [materializeSelectOptions]="usuarios" formControlName="segundoSubstituto">
                        <option disabled>Opcional</option>
                        <option *ngFor="let usuario of usuarios" [value]="usuario.nome"
                        [selected]="usuario.nome == segundoSubstituto">{{usuario.nome}}
                        </option>
                    </select>
                    <label for="nome_substituto_2">Segundo Substituto</label>
                </div>
            </div>
            <div class='row'>
                <div class="input-field col s4">
                    <select materialize="material_select" id="nome_substituto_3" class="validate"
                    [materializeSelectOptions]="usuarios" formControlName="terceiroSubstituto">
                        <option disabled>Opcional</option>
                        <option *ngFor="let usuario of usuarios" [value]="usuario.nome"
                                [selected]="usuario.nome == terceiroSubstituto">{{usuario.nome}}
                        </option>
                    </select>
                    <label for="nome_substituto_2">Terceiro Substituto</label>
                </div>
                <div class="input-field col s4">
                    <select materialize="material_select" id="nome_substituto_4" class="validate"
                    [materializeSelectOptions]="usuarios" formControlName="quartoSubstituto">
                        <option disabled>Opcional</option>
                        <option *ngFor="let usuario of usuarios" [value]="usuario.nome"
                        [selected]="usuario.nome == quartoSubstituto">{{usuario.nome}}
                        </option>
                    </select>
                    <label for="nome_substituto_2">Quarto Substituto</label>
                </div>
            </div>
            <div class="row">
                <div class="input-field col ">
                    <input placeholder="Ex.: 70/2013" id="numero_contrato" type="text" class="validate"
                           formControlName="numeroContrato" [attr.disabled]="true">
                    <label for="numero_contrato">Número do Contrato</label>
                </div>
                <div class="input-field col s6">
                    <input id="nome_empresa" class="validate" placeholder="" type="text" formControlName="nomeEmpresa"
                           [attr.disabled]="true">
                    <label for="nome_empresa">Nome da Empresa</label>
                </div>
                <div class="input-field col ">
                    <input placeholder="Ex.: 03677085700013" id="cnpj" type="text" class="validate"
                        formControlName="cnpj" [attr.disabled]="true">
                    <label for="cnpj">CNPJ</label>
                </div>
            </div>
            <div class="row">
                <div class="input-field col ">
                    <input placeholder="dd/mm/aaaa" type="text" id="data_inicio" class="validate"
                        formControlName="inicioVigencia" appMaskDate>
                    <label for="data_inicio">Inicio da Vigência<span class="mensagem-erro">*</span></label>
                    <div *ngIf="myForm.get('inicioVigencia').invalid && (myForm.get('inicioVigencia').dirty || myForm.get('inicioVigencia').touched)">
                        <div *ngIf="myForm.get('inicioVigencia').getError('mensagem')">
                            <div *ngFor="let msg of myForm.get('inicioVigencia').getError('mensagem')[0]">
                                <span class="mensagem-erro">{{msg}}</span>
                            </div>
                        </div>
                        <div *ngIf="myForm.get('inicioVigencia').getError('required')">
                            <span class="mensagem-erro">Você deve digitar uma data!</span>
                        </div>
                    </div>
                </div>
                <div class="input-field col "><input class="validate" placeholder="dd/mm/aaaa" id="data_fim" type="text"
                        formControlName="fimVigencia" appMaskDate>
                    <label for="data_fim">Fim da Vigência<span class="mensagem-erro">*</span></label>
                    <div *ngIf="myForm.get('fimVigencia').invalid && (myForm.get('fimVigencia').dirty || myForm.get('fimVigencia').touched)">
                        <div *ngIf="myForm.get('fimVigencia').getError('mensagem')">
                            <div *ngFor="let msg of myForm.get('fimVigencia').getError('mensagem')[0]">
                                <span class="mensagem-erro">{{msg}}</span>
                            </div>
                        </div>
                        <div *ngIf="myForm.get('fimVigencia').getError('required')">
                            <span class="mensagem-erro">Você deve digitar uma data!</span>
                        </div>
                    </div>
                </div>
                <div class="input-field col ">
                    <input class=" validate" placeholder="dd/mm/aaaa" id="data_assinatura" formControlName="assinatura"
                        type="text" appMaskDate>
                    <label for="data_assinatura">Data de Assinatura<span class="mensagem-erro">*</span></label>
                    <div *ngIf="myForm.get('assinatura').invalid && (myForm.get('assinatura').dirty || myForm.get('assinatura').touched)">
                        <div *ngIf="myForm.get('assinatura').getError('mensagem')">
                            <div *ngFor="let msg of myForm.get('assinatura').getError('mensagem')[0]">
                                <span class="mensagem-erro">{{msg}}</span>
                            </div>
                        </div>
                        <div *ngIf="myForm.get('assinatura').getError('required')">
                            <span class="mensagem-erro">Você deve digitar uma data!</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="input-field col s12">
                    <textarea materialize id="objeto" data-length="200" formControlName="objeto"
                              class="materialize-textarea" [attr.disabled]="true"></textarea>
                    <label for="objeto">Objeto</label>
                </div>
            </div>
            <div class="row">
                <div class="input-field col s12">
                    <textarea class="materialize-textarea" materialize
                              id="assunto" formControlName="assunto"
                              data-length="120"></textarea>
                    <label for="assunto">Assunto</label>
                </div>
            </div>
            <h5 class="left-align">Percentuais</h5>
            <div class="row">
                <div class="input-field col s4">
                    <select id="percentual_ferias" materialize="material_select" formControlName="percentualFerias"
                        [materializeSelectOptions]="percentuaisFerias">
                        <option disabled>Selecione um percentual para Férias</option>
                        <option *ngFor="let percentual of percentuaisFerias" [value]="percentual.percentual"
                            [selected]="percentual.percentual == percentualFerias">{{percentual.percentual / 100 | percent}}
                        </option>
                    </select>
                    <label for="percentual_ferias">Percentual de Férias<span class="mensagem-erro">*</span></label>
                </div>
                <div class="input-field col s5">
                    <select id="percentual_decimo_terceiro" materialize="material_select"
                        formControlName="percentualDecimoTerceiro" [materializeSelectOptions]="percentuaisDecimoTerceiro">
                        <option disabled>Selecione um percentual para Décimo Terceiro</option>
                        <option *ngFor="let percentual of percentuaisDecimoTerceiro" [value]="percentual.percentual"
                            [selected]="percentual.percentual == percentualDecimoTerceiro">{{percentual.percentual / 100 | percent}}
                        </option>
                    </select>
                    <label for="percentual_decimo_terceiro">Percentual de Décimo Terceiro<span
                        class="mensagem-erro">*</span></label>
                </div>
                <div class="input-field col s3">
                    <input id="percentual_incidencia" class="validate" currencyMask
                        [options]="{ prefix: '', thousands: '.', decimal: ',', allowNegative: 'false', suffix: '%'}"
                        type="text" formControlName="percentualIncidencia">
                    <label for="percentual_incidencia">Percentual de Incidência do Submódulo 4.1<span class="mensagem-erro">*</span></label>
                    <div *ngIf="myForm.get('percentualIncidencia').invalid && (myForm.get('percentualIncidencia').dirty || myForm.get('percentualIncidencia').touched)">
                        <div *ngIf="myForm.get('percentualIncidencia').getError('mensagem')">
                            <div *ngFor="let msg of myForm.get('percentualIncidencia').getError('mensagem')[0]">
                                <span class="mensagem-erro">{{msg}}</span>
                            </div>
                        </div>
                        <div *ngIf="myForm.get('percentualIncidencia').getError('required')">
                            <span class="mensagem-erro">Você deve digitar um percentual</span>
                        </div>
                    </div>
                </div>
            </div>
            <h5 class="left-align">Funções do Contrato</h5>
                <div formArrayName="cargos" class="row">
                    <div *ngFor="let cargo of getFormArrayItems(); let i = index">
                        <div [formGroupName]="i">
                            <div class="row">
                                <div class="col s12 panel-content darken-1">
                                    <div class="valign-wrapper">
                                        <div class="titulo-modal">
                                            <p class="white-text ">Função {{i + 1}}</p>
                                        </div>
                  <!--<div class=" col offset-l11">
                      <h6 class="botao-fechar" (click)="removeCargo(i)" *ngIf="formArrayLength() > 1"><a class="white-text"><i class="material-icons right">close</i></a></h6>
                  </div> -->
                                    </div>
                                </div>
                            </div>
                            <div class="input-field col s5 form-group">
                                <input id="ajuste_funcoes" formControlName="nome" type="text" class="validate">
                                <label for="ajuste_funcoes">Nome do Cargo<span class="mensagem-erro">*</span></label>
                            </div>
                            <div class="input-field col form-group">
                                <input id="remuneracao_field" formControlName="remuneracao" type="text" currencyMask
                                    [options]="{prefix: 'R$', thousands: '.', decimal: ',', allowNegative: 'false'}" required>
                                <label for="remuneracao_field">Salário Base<span class="mensagem-erro">*</span></label>
                            </div>
                            <div class="input-field col form-group">
                                <input id="trienios_field" formControlName="trienios" type="text" currencyMask
                                    [options]="{prefix: 'R$', thousands: '.', decimal: ',', allowNegative: 'false'}">
                                <label for="trienios_field">Triênios</label>
                            </div>
                            <div class="input-field col form-group">
                                <input id="adicionais_field" formControlName="adicionais" type="text" currencyMask
                                    [options]="{prefix: 'R$', thousands: '.', decimal: ',', allowNegative: 'false'}" required>
                                <label for="adicionais_field">Adicionais<span class="mensagem-erro">*</span></label>
                            </div>
                            <div class="col s12">
                                <div class="row">
                                    <div class="input-field col s12 form-group">
                                        <select [materializeSelectOptions]="convencoesColetivas" formControlName="convencao"
                                            materialize="material_select" class="cargos validate"
                                            (change)="selectConvencao($event.target.value, i)">
                                            <option disabled>Selecione uma convenção</option>
                                            <option *ngFor="let convencao of convencoesColetivas" [value]="convencao.codigo"
                                                [selected]="convencao.codigo == this.myForm.get('cargos').get('' + i).get('convencao').value">
                                                {{convencao.sigla}} - {{convencao.nome}}
                                            </option>
                                        </select>
                                        <label>Convenção Coletiva<span class="mensagem-erro">*</span></label>
                                    </div>
                                </div>
                            </div>
                            <div class="input-field col form-group">
                                <input class="validate" placeholder="Ex.:01/01/2000" id="data-base"
                                    formControlName="dataBase" type="text" appMaskDate [attr.disabled]="true">
                                <label for="data-base">Data Base<span class="mensagem-erro">*</span></label>
                            </div>
            <!--<div class="input-field col l12 form-group">
                <textarea placeholder="Descrição" class="materialize-textarea" data-length="200"
                          id="textarea2" formControlName="descricao"></textarea>
                <label for="textarea2">Descrição do Cargo</label>
            </div> -->
                        </div>
                    </div>
                </div>
      <!--<button class="btn waves-effect waves-light" (click)="adicionaCargo(); $event.preventDefault();">Adicionar
          Outro Cargo
      </button> -->
        </form>
        <div class="center-align">
            <button class="btn waves-effect" [disabled]="myForm.invalid" (click)="verificaAjusteASerCadastrado()">Cadastrar Ajuste</button>
        </div>
    </div>
</div>
<div *ngIf="tempCon" id="modal1" class="modal" materialize="modal" [materializeParams]="[{dismissible: false}]"
     [materializeActions]="modalActions">
    <div class="modal-content">
        <h4 class="center">Confirmar Alterações de ajuste</h4>
        <div class="divider">
        </div>
        <br>
        <div class="left-align">
            <div class="row">
                <div clas="col s12">
                    <div class="valign-wrapper">
                        <span class="warning-text"><i class="material-icons left">warning</i>As alterações não poderão ser desfeitas</span>
                    </div>
                </div>
            </div>
        </div>
        <div class="row grey">
            <div class="col s12">
                <h5 class="left-align">Contrato:
                    <small>{{contrato.nomeDaEmpresa}} - {{contrato.numeroDoContrato}}</small>
                </h5>
                <div class="row">
                    <ul>
                        <li class="active">
                            <div class="">
                                <h5>Vigência</h5>
                            </div>
                            <div class="col s3 offset-s1 highlight">
                                <h5>De<small>{{tempCon.eventoContratual.dataInicioVigencia | date:'shortDate'}}</small>
                                    a<small>{{tempCon.eventoContratual.dataFimVigencia | date: 'shortDate'}}</small>
                                </h5>
                            </div>
                            <div class=" col s3 highlight">
                                <h5>Assinado em:
                                    <small>{{tempCon.eventoContratual.dataAssinatura | date: 'shortDate'}}</small>
                                </h5>
                            </div>
                        </li>
                    </ul>
                </div>
                <div class="row">
                    <ul>
                        <li class="active">
                            <div class="">
                                <h5>Ajuste</h5>
                            </div>
                            <div class="col s3 offset-s1 highlight">
                                <h5>Tipo de Ajuste:
                                    <small>{{tempCon.eventoContratual.tipo.tipo}}</small>
                                </h5>
                            </div>
                            <div class=" col s3 highlight">
                                <h5>Prorrogação:
                                    <small>{{tempCon.eventoContratual.prorrogacao | afirimativePipe}}</small>
                                </h5>
                            </div>
                        </li>
                    </ul>
                </div>
                <div class="row" *ngIf="tempCon.historicoGestao.length > 0">
                    <ul>
                        <li class="active">
                            <div>
                                <h5>Gestão do Contrato</h5>
                            </div>
                            <div class="row highlight" *ngFor="let historico of tempCon.historicoGestao">
                                <div class="col s3 offset-s1">
                                    <h5 *ngIf="historico.codigoPerfilGestao == 1">Gestor:
                                        <small>{{historico.gestor}}</small>
                                    </h5>
                                    <h5 *ngIf="historico.codigoPerfilGestao == 2">Primeiro Substituto:
                                        <small>{{historico.gestor}}</small>
                                    </h5>
                                    <h5 *ngIf="historico.codigoPerfilGestao == 3">Segundo Substituto:
                                        <small>{{historico.gestor}}</small>
                                    </h5>
                                    <h5 *ngIf="historico.codigoPerfilGestao == 4">Terceiro Substituto:
                                        <small>{{historico.gestor}}</small>
                                    </h5>
                                    <h5 *ngIf="historico.codigoPerfilGestao == 5">Quarto Substituto:
                                        <small>{{historico.gestor}}</small>
                                    </h5>
                                </div>
                            </div>
                        </li>
                    </ul>
                </div>
                <div class="row" *ngIf="tempCon.percentuais.length > 0">
                    <ul>
                        <li class="active">
                            <div class="">
                                <h5>Percentuais</h5>
                            </div>
                            <div class="row highlight" *ngFor="let percentual of tempCon.percentuais">
                                <div class="col s5 offset-s1">
                                    <h5>Percentual:
                                        <small>{{percentual.nome}}</small>
                                    </h5>
                                </div>
                                <div class=" col s3">
                                    <h5>Valor:
                                        <small>{{percentual.percentual / 100 | percent:'1.2-2'}}</small>
                                    </h5>
                                </div>
                            </div>
                        </li>
                    </ul>
                </div>
                <div class="row" *ngIf="tempCon.funcoes.length > 0">
                    <ul>
                        <li class="active">
                            <div class="">
                                <h5>Funções</h5>
                            </div>
                            <div class="row highlight" *ngFor="let funcao of tempCon.funcoes">
                                <div class="col s4 offset-s1">
                                    <h5>Função:
                                        <small>{{funcao.nome}}</small>
                                    </h5>
                                </div>
                                <div class=" col s2">
                                    <h5>Salário Base:
                                        <small>{{funcao.remuneracao | currency:'BRL':true:'1.2-2'}}</small>
                                    </h5>
                                </div>
                                <div class="col s2">
                                    <h5>Adicionais:
                                        <small>{{funcao.adicionais | currency:'BRL':true:'1.2-2'}}</small>
                                    </h5>
                                </div>
                                <div class=" col s2">
                                    <h5>Triênios:
                                        <small>{{funcao.trienios | currency:'BRL':true:'1.2-2'}}</small>
                                    </h5>
                                </div>
                                <div class=" col s6 offset-s1" *ngIf="funcao.convencao">
                                    <h5>Convenção Coletiva:
                                        <small>{{funcao.convencao.sigla}}</small>
                                    </h5>
                                </div>
                                <div class=" col s2" *ngIf="funcao.convencao">
                                    <h5>Data Base:
                                        <small>{{funcao.convencao.dataBase | date: 'shortDate'}}</small>
                                    </h5>
                                </div>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn waves-effect left" (click)="closeModal()">Cancelar</button>
            <button class="btn waves-effect right" (click)="cadastrarAjuste()">Confirmar</button>
        </div>
    </div>
</div>
<div id="modal2" class="modal" materialize="modal" [materializeParams]="[{dismissible: false}]"
     [materializeActions]="modalActions2">
    <div class="modal-content">
        <h4 class="center">Sucesso</h4>
        <br>
        <h5 class=" center">Cadastro efetuado com sucesso !</h5>
    </div>
    <div class="modal-footer">
        <button id="button-footer" class="btn waves-effect" (click)="closeModal2()">Ok</button>
    </div>
</div>
<div id="modal3" class="modal" materialize="modal" [materializeParams]="[{dismissible: false}]"
     [materializeActions]="modalActions3">
    <div class="modal-content">
        <h4 class="center">Erro</h4>
        <br>
        <h5 class=" center"><span class="mensagem-erro">Houve uma falha ao tentar cadastrar o ajuste ! Tente novamente mais tarde ou entre em contato
            com o administrador do sistema</span>
        </h5>
    </div>
    <div class="modal-footer">
        <button class="button-footer" class="btn waves-effect" (click)="closeModal3()">Ok</button>
    </div>
</div>
